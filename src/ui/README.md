# UI模块说明

## 概述
这个模块包含了Pank Ins项目的所有用户界面组件，使用PySide6框架开发。采用完全模块化设计，每个UI区域都是独立的组件文件。

## 模块化架构

### 文件结构
```
src/ui/
├── main_window.py          # 主窗口（整合所有组件）
├── left_sidebar.py         # 左侧边栏（功能导航）
├── work_area.py           # 工作区域（主要内容显示）
├── ai_chat_panel.py       # AI对话面板（右侧，支持Markdown）
├── log_area.py            # 日志区域（底部）
├── login_window.py        # 登录窗口
├── app_launcher.py        # 应用启动器
├── test_main.py           # 主窗口测试
├── test_login.py          # 登录窗口测试
├── test_ai_chat.py        # AI对话面板测试
└── __init__.py            # 模块导入
```

### 布局结构
```
┌─────────────────────────────────────────────────────────────┐
│                        菜单栏                                │
├─────────────┬─────────────────────────────┬─────────────────┤
│             │                             │                 │
│   左侧边栏   │         工作区域             │   AI对话面板     │
│             │                             │                 │
│             ├─────────────────────────────┤                 │
│             │         日志区域             │                 │
├─────────────┴─────────────────────────────┴─────────────────┤
│                        状态栏                                │
└─────────────────────────────────────────────────────────────┘
```

## 组件详细说明

### MainWindow (主窗口)
**文件**: `main_window.py`

主窗口整合所有UI组件，提供完整的应用界面：
- **简化设计**: 移除了工具栏，保留菜单栏和状态栏
- **模块化集成**: 导入并组装各个独立组件
- **可拖拽布局**: 支持拖动分割线调整各区域大小
- **信号通信**: 协调各组件间的消息传递

**主要特性**:
- 窗口大小: 1400x900像素
- 布局比例: 左:中:右 = 1:3.6:1.4
- 垂直分割: 工作区:日志区 = 3:1

### LeftSidebar (左侧边栏)
**文件**: `left_sidebar.py`

功能模块导航面板：
- **树形结构**: 显示AI控制、插件管理、设备管理、系统设置等模块
- **交互功能**: 点击项目发送选择信号
- **刷新按钮**: 支持模块列表刷新
- **展开折叠**: 支持树形节点的展开和折叠

**功能模块**:
- AI控制: 示波器控制、参数设置、自动测试
- 插件管理: 时序图插件、数据分析插件、报告生成插件
- 设备管理: 设备连接、设备状态、设备配置
- 系统设置: 用户设置、系统配置、日志设置

### WorkArea (工作区域)
**文件**: `work_area.py`

主要工作内容显示区域：
- **单一区域**: 不再分割，提供完整的工作空间
- **内容替换**: 支持动态替换显示内容
- **占位符设计**: 当前为演示用占位符
- **可扩展**: 易于集成实际功能组件

**主要方法**:
- `set_content(widget)`: 设置工作区内容
- `clear_content()`: 清空工作区内容

### AIChatPanel (AI对话面板) ⭐ 新功能
**文件**: `ai_chat_panel.py`

现代化的AI对话界面，支持完整的Markdown格式：

#### 🎨 界面设计
- **简洁标题栏**: 移除了状态指示，只保留"AI智能助手"标题
- **美观设计**: 仿微信/QQ的聊天界面风格
- **消息气泡**: 用户和AI消息使用不同样式的气泡
- **自适应高度**: AI消息区域根据内容自动调整高度

#### 📝 Markdown支持
- **完整语法**: 支持标准Markdown语法
- **代码高亮**: 支持代码块语法高亮
- **表格支持**: 支持Markdown表格格式
- **列表格式**: 支持有序和无序列表
- **文本样式**: 支持**粗体**、*斜体*等格式

#### 🚀 功能特性
- **实时对话**: 支持实时消息发送和接收
- **智能回复**: 内置丰富的Markdown格式回复模板
- **滚动显示**: 自动滚动到最新消息
- **历史记录**: 保存完整的对话历史

#### 💬 消息样式
- **用户消息**: 蓝色气泡，右对齐，纯文本显示
- **AI消息**: 灰色气泡，左对齐支持Markdown渲染
- **时间戳**: 每条消息显示发送时间
- **发送者标识**: 区分用户和AI助手

#### 🛠️ 技术实现
- **用户消息**: 使用QLabel显示纯文本
- **AI消息**: 使用QTextEdit + HTML渲染Markdown
- **自动高度**: 根据内容动态调整消息框高度
- **最大高度**: 限制单条消息最大高度为300px

#### 📋 功能方法
- `add_message(message, is_user)`: 添加消息（支持Markdown）
- `send_message()`: 发送用户消息
- `clear_chat()`: 清空聊天记录
- `get_chat_history()`: 获取聊天历史

#### 🎯 示例回复格式
AI助手现在支持丰富的Markdown格式回复，包括：

```markdown
## 示波器控制功能

### 基本控制
- **连接设备** - 建立通信连接
- **参数设置** - 配置采样率、触发等

### 代码示例
```python
def run_test():
    scope.connect()
    return scope.capture()
```

**注意**: 请确保设备已正确连接
```

### LogArea (日志区域)
**文件**: `log_area.py`

系统日志显示组件：
- **实时日志**: 显示系统运行日志信息
- **颜色分级**: 不同级别日志使用不同颜色显示
- **自动滚动**: 新日志自动滚动到底部
- **清空功能**: 支持一键清空日志
- **定时更新**: 模拟系统日志的定时更新

**日志级别**:
- INFO: 绿色 (#48bb78)
- DEBUG: 蓝色 (#90cdf4)
- WARNING: 橙色 (#ed8936)
- ERROR: 红色 (#f56565)

### LoginWindow (登录窗口)
**文件**: `login_window.py`

现代化登录界面（保持原有功能）

### AppLauncher (应用启动器)
**文件**: `app_launcher.py`

统一的应用启动管理（保持原有功能）

## 测试文件

### test_main.py
测试主窗口的完整功能，包括所有模块化组件的集成。

### test_ai_chat.py
独立测试AI对话面板，可以单独运行查看Markdown渲染效果和新的界面设计。

### test_login.py
测试登录窗口功能。

## 使用方法

### 快速启动
```bash
# Windows用户 - 交互式启动菜单
start_ui.bat

# 直接启动主窗口
python src\ui\app_launcher.py --mode main

# 启动登录流程
python src\ui\app_launcher.py --mode login
```

### 独立测试
```bash
# 测试主窗口
python src\ui\test_main.py

# 测试AI对话面板（推荐！查看Markdown效果）
python src\ui\test_ai_chat.py

# 测试登录窗口
python src\ui\test_login.py
```

### 模块导入
```python
# 导入所有组件
from src.ui import (
    MainWindow, LeftSidebar, WorkArea, 
    AIChatPanel, LogArea, LoginWindow, AppLauncher
)

# 创建主窗口
main_window = MainWindow()
main_window.show()

# 或者单独使用AI对话面板
chat_panel = AIChatPanel()
chat_panel.show()
```

## 设计特点

### 1. 完全模块化
- 每个UI区域都是独立的文件和类
- 组件间通过信号槽机制通信
- 易于维护和扩展

### 2. 现代化设计
- 统一的颜色方案和设计语言
- 圆角设计和渐变效果
- 响应式布局和悬浮效果

### 3. AI对话体验 ⭐ 升级
- **Markdown渲染**: 支持完整的Markdown语法
- **专业格式**: 代码块、表格、列表等专业格式
- **简洁界面**: 移除冗余的状态指示
- **智能回复**: 丰富的格式化回复模板

### 4. 可扩展架构
- 工作区域支持动态内容替换
- AI对话面板可集成真实的AI服务
- 左侧边栏可添加更多功能模块

## 颜色方案
- **主色调**: #667eea (蓝紫色)
- **背景色**: #f8fafc (浅灰)
- **边框色**: #e2e8f0 (灰色)
- **文字色**: #2d3748 (深灰)
- **AI消息**: #f7fafc (浅灰背景)
- **用户消息**: #667eea (蓝色背景)
- **成功色**: #48bb78 (绿色)
- **警告色**: #ed8936 (橙色)
- **错误色**: #f56565 (红色)

## 依赖
- PySide6
- **markdown** ⭐ 新增 - 用于Markdown格式渲染
- Python 3.8+

## 最新更新 🆕

### v1.1.0 - Markdown支持
- ✅ **移除状态栏**: AI对话面板标题栏更加简洁
- ✅ **Markdown支持**: AI消息完全支持Markdown格式
- ✅ **代码高亮**: 支持代码块语法高亮
- ✅ **自适应高度**: 消息框根据内容自动调整高度
- ✅ **丰富回复**: 预设多种Markdown格式的智能回复

### 测试Markdown功能
运行AI对话面板测试，尝试以下关键词查看Markdown效果：
- 输入 "帮助" - 查看完整的帮助文档格式
- 输入 "示波器" - 查看功能说明和列表格式
- 输入 "测试" - 查看代码块和编号列表
- 输入 "你好" - 查看表情符号和格式化文本

## 扩展建议

### 1. AI对话增强
- 集成真实的AI服务（如OpenAI API）
- 支持更多Markdown扩展（如数学公式）
- 添加消息搜索和过滤功能
- 支持文件上传和图片显示

### 2. 工作区域扩展
- 添加标签页支持多个工作内容
- 集成示波器数据显示组件
- 添加图表和数据可视化

### 3. 左侧边栏增强
- 添加搜索功能
- 支持自定义模块排序
- 添加快捷操作按钮

### 4. 日志系统增强
- 支持日志过滤和搜索
- 添加日志导出功能
- 支持日志级别动态调整 